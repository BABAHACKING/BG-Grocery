<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details | Freshcart Premium</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .details-container {
            max-width: 1200px;
            margin: 4rem auto;
            padding: 0 5%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
        }

        .product-image-card {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .product-image-card img {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            transition: var(--transition);
        }

        .details-info h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 3rem;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .price-tag {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .price-tag span {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .benefit-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #e8f5e9;
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .reviews-section {
            margin-top: 4rem;
            padding-top: 3rem;
            border-top: 1px solid #eff2ef;
        }

        .review-card {
            background: #f8faf8;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            border: 1px solid #eff2ef;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .review-user {
            font-weight: 600;
            color: var(--text-primary);
        }

        .review-rating {
            color: var(--accent);
            font-weight: 700;
        }

        .add-review-form {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-top: 2rem;
            border: 1px solid #eff2ef;
        }

        .add-review-form input,
        .add-review-form textarea {
            width: 100%;
            padding: 0.85rem 1.25rem;
            border: 1px solid #e0e4e0;
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            font-family: inherit;
        }

        @media (max-width: 968px) {
            .details-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .product-image-card {
                position: static;
            }
        }
    </style>
</head>

<body>
    <!-- Sticky Header -->
    <header id="main-header">
        <a href="index.html" class="logo">Freshcart</a>
        <div class="search-bar">
            <input type="text" id="product-search" placeholder="Search for groceries...">
            <button onclick="searchProducts()">Search</button>
        </div>
        <nav>
            <ul>
                <li><button class="nav-icon-btn" onclick="location.href='wishlist.html'"><img src="heart(1).svg"
                            alt="Wishlist"></button></li>
                <li><button class="nav-icon-btn" onclick="location.href='login.html'"><img src="person.svg"
                            alt="Profile"></button></li>
                <li>
                    <button class="nav-icon-btn" id="cart-drawer-btn">
                        <img src="cart3(1).svg" alt="Cart">
                        <span class="cart-count">0</span>
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <div class="details-container" id="product-details-root">
        <!-- Rendered by JS -->
        <div style="grid-column: span 2; text-align: center; padding: 5rem;">
            <h2>Loading product details...</h2>
        </div>
    </div>

    <!-- Side Drawer Cart -->
    <div class="cart-drawer" id="cart-drawer">
        <div class="cart-drawer-header">
            <h3>Your Cart</h3>
            <button class="nav-icon-btn" id="close-drawer">✕</button>
        </div>
        <div class="cart-drawer-content" id="cart-drawer-items"></div>
        <div class="cart-drawer-footer">
            <button class="buy-now" style="width: 100%; border-radius: var(--radius-sm);"
                onclick="location.href='cart.html'">View Full Cart</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <footer class="footer">
        <div class="footer-bottom">
            <p>&copy; 2025 Freshcart. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            const product = productsData[productId];

            if (!product) {
                document.getElementById('product-details-root').innerHTML = `
                    <div style="grid-column: span 2; text-align: center; padding: 5rem;">
                        <h1>Product Not Found</h1>
                        <p>Sorry, we couldn't find the fruit you're looking for.</p>
                        <button class="buy-now" onclick="location.href='index.html'" style="width: auto; margin-top: 2rem; padding: 1rem 2rem;">Back to Shop</button>
                    </div>
                `;
                return;
            }

            renderProductDetails(product, productId);
        });

        function renderProductDetails(product, id) {
            const root = document.getElementById('product-details-root');
            const benefitsHtml = product.benefits.map(b => `<span class="benefit-badge">✓ ${b}</span>`).join('');
            const reviewsHtml = product.reviews.length > 0
                ? product.reviews.map(r => `
                    <div class="review-card">
                        <div class="review-header">
                            <span class="review-user">${r.user}</span>
                            <span class="review-rating">${"★".repeat(r.rating)}${"☆".repeat(5 - r.rating)}</span>
                        </div>
                        <p>${r.comment}</p>
                    </div>`).join('')
                : `<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No reviews yet. Be the first to review!</p>`;

            root.innerHTML = `
                <div class="product-image-card">
                    <img src="${product.image}" alt="${product.name}">
                </div>
                <div class="details-info">
                    <span class="product-tag">${product.tag}</span>
                    <h1>${product.name}</h1>
                    <div class="price-tag">₹${product.price} <span>/ ${product.unit}</span></div>
                    
                    <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 2rem;">${product.description}</p>
                    
                    <div style="margin-bottom: 2.5rem;">
                        <h3 style="margin-bottom: 1rem; font-family: 'Outfit';">Key Benefits</h3>
                        ${benefitsHtml}
                    </div>

                    <div class="product-actions" style="max-width: 400px; margin-bottom: 3rem;">
                        <button class="add-to-cart" onclick="addToCart('${product.name}', ${product.price}, '${product.image}')" style="padding: 1.25rem;">Add to Cart</button>
                        <button class="buy-now" onclick="buyNow('${product.name}', ${product.price}, '${product.image}')" style="padding: 1.25rem;">Buy Now</button>
                    </div>

                    <div class="reviews-section">
                        <h2 style="font-family: 'Outfit'; margin-bottom: 2rem;">Customer Reviews</h2>
                        <div id="reviews-list">
                            ${reviewsHtml}
                        </div>

                        <div class="add-review-form">
                            <h3 style="margin-bottom: 1.5rem;">Leave a Review</h3>
                            <input type="text" id="review-user" placeholder="Your Name">
                            <select id="review-rating" style="width: 100%; padding: 0.85rem; border: 1px solid #e0e4e0; border-radius: var(--radius-sm); margin-bottom: 1rem;">
                                <option value="5">5 Stars - Excellent</option>
                                <option value="4">4 Stars - Very Good</option>
                                <option value="3">3 Stars - Good</option>
                                <option value="2">2 Stars - Fair</option>
                                <option value="1">1 Star - Poor</option>
                            </select>
                            <textarea id="review-comment" rows="4" placeholder="Share your experience..."></textarea>
                            <button class="buy-now" onclick="submitReview('${id}')">Submit Review</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function submitReview(id) {
            const user = document.getElementById('review-user').value.trim();
            const rating = parseInt(document.getElementById('review-rating').value);
            const comment = document.getElementById('review-comment').value.trim();

            if (!user || !comment) {
                showToast("Please fill in all fields");
                return;
            }

            // In a real app, this would be a POST request. Here we update mock data.
            productsData[id].reviews.unshift({ user, rating, comment });
            renderProductDetails(productsData[id], id);
            showToast("Review submitted! Thank you.");
        }
    </script>
</body>

</html>